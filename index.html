<!DOCTYPE html>
<html>
<head>
  <title>KPA Windows 11 Upgrade Team</title>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #fff;
      padding: 20px;
      text-align: center;
    }
    #logo {
      height: 90px;
      margin-bottom: 10px;
    }
    #title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .controls {
      margin-bottom: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 5px;
      border: 1px solid #000;
      font-size: 12px;
      text-align: left;
    }
    #footer {
      font-size: 12px;
      margin-top: 20px;
      font-style: italic;
    }
  </style>
</head>
<body>

  <img src="logo.jpeg" alt="Logo" id="logo" />
  <div id="title">KPA WINDOWS 11 UPGRADE TEAM. NAIROBI ICD EXCEL TO PDF CONVERTOR</div>

  <div class="controls">
    <input type="file" id="inputFile" />
    <button onclick="downloadPDF()">Download as PDF</button>
  </div>

  <div id="tableContainer">
    <table id="excelTable">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="footer">Powered by Abicheru Technologies</div>

  <script>
    let tableData = [];

    document.getElementById('inputFile').addEventListener('change', function(e) {
      const file = e.target.files[0];
      const reader = new FileReader();

      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, { type: 'array' });
        const sheet = workbook.Sheets[workbook.SheetNames[0]];
        const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
        tableData = jsonData;
        displayTable(jsonData);
      };

      reader.readAsArrayBuffer(file);
    });

    function displayTable(data) {
      const thead = document.querySelector('#excelTable thead');
      const tbody = document.querySelector('#excelTable tbody');
      thead.innerHTML = '';
      tbody.innerHTML = '';

      data.forEach((row, i) => {
        const tr = document.createElement('tr');
        row.forEach(cell => {
          const el = document.createElement(i === 0 ? 'th' : 'td');
          el.textContent = cell ?? '';
          tr.appendChild(el);
        });
        (i === 0 ? thead : tbody).appendChild(tr);
      });
    }

    function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('p', 'pt', 'a4');
      const logo = new Image();
      logo.src = document.getElementById('logo').src;

      logo.onload = () => {
        doc.addImage(logo, 'PNG', 220, 20, 150, 60);
        doc.setFontSize(14);
        doc.text("KPA WINDOWS 11 UPGRADE TEAM. NAIROBI ICD", 50, 100);

        doc.autoTable({
          head: [tableData[0]],
          body: tableData.slice(1),
          startY: 110,
          styles: { fontSize: 8 },
          theme: 'grid',
        });

        const finalY = doc.lastAutoTable.finalY || 110;
        doc.setFontSize(10);
        doc.text("Powered by Abicheru Technologies", 50, finalY + 30);
        doc.save('kpa_upgrade_team.pdf');
      };
    }
  </script>
</body>
</html>
